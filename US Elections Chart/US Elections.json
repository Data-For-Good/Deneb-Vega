{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "",
  "height": 1000,
  "padding": 5,
  "signals": [
    {"name": "nameLeft", "value": "Biden"},
    {"name": "nameRight", "value": "Trump"},
    {"name": "votesMax", "value": 538},
    {"name": "colorLeftBlue", "value": "#0F4392"},
    {"name": "colorRightRed", "value": "#DD1717"},
    {"name": "colorGray", "value": "gray"},
    {"name": "colorBarStroke", "value": "white"},
    {"name": "colorStackSeparator", "value": "#FFFFFF"},
    {"name": "colorStateLabel", "value": "#000000"},
    {"name": "colorAxisTicksAndLabels", "value": "#BBBBBB"},
    {"name": "fillOpacityDefault", "value": 0.8},
    {"name": "fillOpacityHoverGray", "value": 0.3},
    {"name": "fillOpacityHoverTotal", "value": 0.9},
    {"name": "fillOpacityClaimed", "value": 0.5},
    {"name": "fillOpacityGray", "value": 0.15},
    {"name": "tickOpacity", "value": 0.3},
    {"name": "chartWidth", "value": 300},
    {"name": "chartPad", "value": 50},
    {"name": "width", "update": "2 * chartWidth + chartPad"},
    {
      "name": "leftGrayBar_clicked",
      "value": false,
      "on": [
        {
          "events": "@leftGrayBar:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "leftColorBar_clicked",
      "value": false,
      "on": [
        {
          "events": "@leftColorBar:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "rightGrayBar_clicked",
      "value": false,
      "on": [
        {
          "events": "@rightGrayBar:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "rightColorBar_clicked",
      "value": false,
      "on": [
        {
          "events": "@rightColorBar:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    }
  ],
  "data": [
    {
      "name": "dataset",
      "url": "https://raw.githubusercontent.com/avatorl/Deneb-Vega/main/US%20Elections%20Chart/us-elections-data.json"
    },
    {
      "name": "data-left",
      "source": "dataset",
      "transform": [
        {"type": "filter", "expr": "datum['candidate'] == nameLeft"}
      ]
    },
    {
      "name": "data-right",
      "source": "dataset",
      "transform": [
        {"type": "filter", "expr": "datum['candidate'] == nameRight"}
      ]
    },
    {
      "name": "data-state",
      "source": "dataset",
      "transform": [
        {"type": "aggregate", "groupby": ["state", "index", "votes"]},
        {"type": "collect", "sort": {"field": "votes"}}
      ]
    },
    {
      "name": "claimed-left-state",
      "on": [
        {"trigger": "leftGrayBar_clicked", "insert": "leftGrayBar_clicked"},
        {"trigger": "rightColorBar_clicked", "remove": "rightColorBar_clicked"}
      ]
    },
    {
      "name": "claimed-right-state",
      "on": [
        {"trigger": "rightGrayBar_clicked", "insert": "rightGrayBar_clicked"},
        {"trigger": "leftColorBar_clicked", "remove": "leftColorBar_clicked"}
      ]
    },
    {
      "name": "data-left-to-right",
      "source": "data-left",
      "transform": [
        {
          "type": "filter",
          "expr": "indata('claimed-right-state', 'value', datum.index)"
        }
      ]
    },
    {
      "name": "data-right-with-claimed",
      "source": ["data-right", "data-left-to-right"],
      "transform": [
        {
          "type": "filter",
          "expr": "!indata('claimed-left-state', 'value', datum.index)"
        },
        {"type": "formula", "as": "side", "expr": "nameRight"}
      ]
    },
    {
      "name": "data-total-right",
      "source": "data-right-with-claimed",
      "transform": [
        {
          "type": "stack",
          "groupby": ["side"],
          "sort": {"field": "votes", "order": "descending"},
          "field": "votes"
        }
      ]
    },
    {
      "name": "data-right-to-left",
      "source": "data-right",
      "transform": [
        {
          "type": "filter",
          "expr": "indata('claimed-left-state', 'value', datum.index)"
        }
      ]
    },
    {
      "name": "data-left-with-claimed",
      "source": ["data-left", "data-right-to-left"],
      "transform": [
        {
          "type": "filter",
          "expr": "!indata('claimed-right-state', 'value', datum.index)"
        },
        {"type": "formula", "as": "side", "expr": "nameRight"}
      ]
    },
    {
      "name": "data-total-left",
      "source": "data-left-with-claimed",
      "transform": [
        {
          "type": "stack",
          "groupby": ["side"],
          "sort": {"field": "votes", "order": "descending"},
          "field": "votes"
        }
      ]
    },
    {
      "name": "data-left-sum",
      "source": "data-total-left",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["side"],
          "ops": ["sum"],
          "fields": ["votes"],
          "as": ["sum"]
        }
      ]
    },
    {
      "name": "data-right-sum",
      "source": "data-total-right",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["side"],
          "ops": ["sum"],
          "fields": ["votes"],
          "as": ["sum"]
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "scaleStatesY",
      "type": "band",
      "range": [{"signal": "height"}, 0],
      "round": true,
      "domain": {"data": "data-state", "field": "index"}
    },
    {"name": "scaleLRCandidates"}
  ],
  "marks": [
    {
      "type": "text",
      "name": "stateName",
      "interactive": false,
      "from": {"data": "data-state"},
      "encode": {
        "enter": {
          "x": {"signal": "0"},
          "y": {"scale": "scaleStatesY", "field": "index", "band": 0.5},
          "text": {"field": "state"},
          "font": {"value": "Thahoma"},
          "fontSize": {"value": 14},
          "baseline": {"value": "middle"},
          "align": {"value": "center"},
          "fill": {"signal": "colorStateLabel"}
        }
      }
    },
    {
      "type": "group",
      "name": "leftHorizontalBars",
      "encode": {"enter": {"x": {"value": 0}, "height": {"signal": "height"}}},
      "scales": [
        {
          "name": "scaleLeftX",
          "reverse": true,
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "-chartPad"}],
          "nice": true,
          "zero": true,
          "domain": {"data": "dataset", "field": "votes"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "scale": "scaleLeftX",
          "title": {"signal": "nameLeft"},
          "titleColor": {"signal": "colorLeftBlue"}
        }
      ],
      "marks": [
        {
          "type": "rect",
          "name": "leftColorBar",
          "from": {"data": "data-left"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "scaleLeftX", "field": "votes"},
              "x2": {"scale": "scaleLeftX", "value": 0},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "height": {"scale": "scaleStatesY", "band": 1, "offset": 0},
              "stroke": {"signal": "colorBarStroke"},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? colorGray : colorLeftBlue"
              },
              "fillOpacity": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? fillOpacityGray : fillOpacityDefault"
              }
            }
          }
        },
        {
          "type": "rect",
          "name": "leftGrayBar",
          "from": {"data": "data-right"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "scaleLeftX", "field": "votes"},
              "x2": {"scale": "scaleLeftX", "value": 0},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "height": {"scale": "scaleStatesY", "band": 1, "offset": 0},
              "stroke": {"signal": "colorBarStroke"},
              "fillOpacity": {"signal": "fillOpacityGray"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? colorLeftBlue : colorGray"
              },
              "fillOpacity": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? fillOpacityClaimed : fillOpacityGray"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverGray"}}
          }
        },
        {
          "type": "text",
          "from": {"data": "data-left-with-claimed"},
          "encode": {
            "enter": {
              "x": {"scale": "scaleLeftX", "field": "votes"},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "dx": {"value": -4},
              "dy": {"value": 2},
              "text": {"signal": "datum.votes"},
              "fontSize": {"signal": "datum.side==nameRight ? 11 : 0"},
              "font": {"value": "Arial"},
              "align": {"value": "right"},
              "baseline": {"value": "top"},
              "fill": {"signal": "colorLeftBlue"}
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "rightHorizontalBars",
      "encode": {"enter": {"x": {"value": 0}, "height": {"signal": "height"}}},
      "scales": [
        {
          "name": "scaleRightX",
          "reverse": false,
          "type": "linear",
          "range": [{"signal": "chartPad"}, {"signal": "chartWidth"}],
          "nice": true,
          "zero": true,
          "domain": {"data": "dataset", "field": "votes"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "scale": "scaleRightX",
          "title": {"signal": "nameRight"},
          "titleColor": {"signal": "colorRightRed"}
        }
      ],
      "marks": [
        {
          "type": "rect",
          "name": "rightColorBar",
          "from": {"data": "data-right"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "scaleRightX", "value": 0},
              "x2": {"scale": "scaleRightX", "field": "votes"},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "height": {"scale": "scaleStatesY", "band": 1, "offset": 0},
              "stroke": {"signal": "colorBarStroke"},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? colorGray : colorRightRed"
              },
              "fillOpacity": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? fillOpacityGray : fillOpacityDefault"
              }
            }
          }
        },
        {
          "type": "rect",
          "name": "rightGrayBar",
          "from": {"data": "data-left"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "scaleRightX", "value": 0},
              "x2": {"scale": "scaleRightX", "field": "votes"},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "height": {"scale": "scaleStatesY", "band": 1, "offset": 0},
              "stroke": {"signal": "colorBarStroke"},
              "fillOpacity": {"signal": "fillOpacityGray"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? colorRightRed : colorGray"
              },
              "fillOpacity": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? fillOpacityClaimed : fillOpacityGray"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverGray"}}
          }
        },
        {
          "type": "text",
          "from": {"data": "data-right-with-claimed"},
          "encode": {
            "enter": {
              "x": {"scale": "scaleRightX", "field": "votes"},
              "y": {"scale": "scaleStatesY", "field": "index"},
              "dx": {"value": 4},
              "dy": {"value": 2},
              "text": {"signal": "datum.votes"},
              "fontSize": {"signal": "datum.side==nameRight ? 11 : 0"},
              "font": {"value": "Arial"},
              "align": {"value": "left"},
              "baseline": {"value": "top"},
              "fill": {"signal": "colorRightRed"}
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "grpTotalLeft",
      "encode": {
        "update": {
          "x": {"signal": "0"},
          "y": {"signal": "-125"},
          "height": {"signal": "height"}
        }
      },
      "scales": [
        {
          "name": "scaleTotalLeft",
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "chartWidth"}],
          "reverse": false,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [0, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 538],
          "domainMin": 0,
          "domainMax": {"signal": "votesMax"}
        },
        {
          "name": "scaleTotalLeft270",
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "chartWidth"}],
          "reverse": false,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [270],
          "domainMin": 0,
          "domainMax": {"signal": "votesMax"}
        },
        {"name": "y", "type": "band"},
        {"name": "color", "type": "ordinal", "range": "category"}
      ],
      "axes": [
        {
          "orient": "top",
          "bandPosition": 0,
          "scale": "scaleTotalLeft",
          "labels": true,
          "ticks": true,
          "tickOpacity": {"signal": "tickOpacity"},
          "tickSize": -55,
          "labelPadding": 55,
          "grid": false
        },
        {
          "orient": "top",
          "scale": "scaleTotalLeft270",
          "labels": true,
          "labelColor": "red",
          "ticks": true,
          "tickOpacity": {"signal": "tickOpacity"},
          "tickSize": -75,
          "tickColor": "red",
          "labelPadding": -15,
          "grid": false
        },
        {"orient": "right", "scale": "y", "ticks": true}
      ],
      "marks": [
        {
          "type": "text",
          "from": {"data": "data-left-sum"},
          "encode": {
            "update": {
              "x": {"scale": "scaleTotalLeft", "field": "sum"},
              "dx": {"value": 5},
              "dy": {"value": 17},
              "text": {"signal": "datum.sum"},
              "font": {"value": "Arial"},
              "stroke": {"signal": "colorLeftBlue"}
            }
          }
        },
        {
          "type": "rect",
          "from": {"data": "data-total-left"},
          "encode": {
            "enter": {
              "height": {"scale": "scaleStatesY", "band": 1.5, "offset": 0},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "y": {"signal": "1"},
              "x": {"scale": "scaleTotalLeft", "field": "y0"},
              "x2": {"scale": "scaleTotalLeft", "field": "y1"},
              "fill": {"signal": "colorLeftBlue"},
              "strokeWidth": {"value": 0.5},
              "strokeOpacity": {"value": 0.5},
              "stroke": {"signal": "colorStackSeparator"},
              "fillOpacity": {
                "signal": "datum.side==datum.candidate? fillOpacityClaimed : fillOpacityDefault"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverTotal"}}
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "grpTotalRight",
      "encode": {
        "update": {
          "x": {"signal": "-chartWidth"},
          "y": {"signal": "-100"},
          "height": {"signal": "height"}
        }
      },
      "scales": [
        {
          "name": "scaleTotalRight",
          "type": "linear",
          "range": [{"signal": "chartWidth*2"}, 0],
          "reverse": true,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [0, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 538],
          "domainMin": 0,
          "domainMax": {"signal": "votesMax"}
        },
        {
          "name": "scaleTotalRight270",
          "type": "linear",
          "range": [{"signal": "chartWidth*2"}, 0],
          "reverse": true,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [270],
          "domainMin": 0,
          "domainMax": {"signal": "votesMax"}
        },
        {
          "name": "y",
          "type": "band",
          "reverse": true,
          "range": "width",
          "domain": {"data": "data-total-right", "field": "candidate"}
        },
        {
          "name": "color",
          "type": "ordinal",
          "range": "width",
          "domain": {"data": "data-total-right", "field": "index"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "bandPosition": 1,
          "scale": "scaleTotalRight",
          "labels": true,
          "ticks": false,
          "tickSize": 0,
          "tickOpacity": {"signal": "tickOpacity"},
          "labelPadding": -45,
          "grid": false
        },
        {
          "orient": "top",
          "bandPosition": 0,
          "scale": "scaleTotalRight270",
          "labels": false,
          "ticks": true,
          "tickSize": 45,
          "tickColor": "red",
          "tickOpacity": {"signal": "tickOpacity"},
          "labelPadding": -40,
          "grid": false
        }
      ],
      "marks": [
        {
          "type": "text",
          "from": {"data": "data-right-sum"},
          "encode": {
            "update": {
              "x": {"scale": "scaleTotalRight", "field": "sum"},
              "dx": {"value": 5},
              "dy": {"value": 17},
              "text": {"signal": "datum.sum"},
              "font": {"value": "Arial"},
              "stroke": {"signal": "colorRightRed"}
            }
          }
        },
        {
          "type": "rect",
          "from": {"data": "data-total-right"},
          "encode": {
            "enter": {
              "height": {"scale": "scaleStatesY", "band": 1.5, "offset": 0},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "y": {"signal": "1"},
              "x": {"scale": "scaleTotalRight", "field": "y0"},
              "x2": {"scale": "scaleTotalRight", "field": "y1"},
              "fill": {"signal": "colorRightRed"},
              "strokeWidth": {"value": 0.5},
              "strokeOpacity": {"value": 0.5},
              "stroke": {"signal": "colorStackSeparator"},
              "fillOpacity": {
                "signal": "datum.side==datum.candidate? fillOpacityDefault : fillOpacityClaimed"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverTotal"}}
          }
        }
      ]
    }
  ]
}
