{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "",
  "height": 1000,
  "padding": 5,
  "signals": [
    {"name": "colorLeftBlue", "value": "#0F4392"},
    {"name": "colorRightRed", "value": "#DD1717"},
    {"name": "colorGray", "value": "gray"},
    {"name": "colorStackSeparator", "value": "#FFFFFF"},
    {"name": "colorStateLabel", "value": "#000000"},
    {"name": "colorAxisTicksAndLabels", "value": "#BBBBBB"},
    {"name": "fillOpacityDefault", "value": "0.8"},
    {"name": "fillOpacityHoverGray", "value": "0.3"},
    {"name": "fillOpacityHoverTotal", "value": "0.5"},
    {"name": "fillOpacityClaimed", "value": "0.5"},
    {"name": "fillOpacityGray", "value": "0.1"},
    {"name": "tickOpacity", "value": "0.3"},
    {"name": "chartWidth", "value": 300},
    {"name": "chartPad", "value": 50},
    {"name": "width", "update": "2 * chartWidth + chartPad"},
    {
      "name": "leftGray_clicked",
      "value": false,
      "on": [
        {
          "events": "@leftGray:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "leftColor_clicked",
      "value": false,
      "on": [
        {
          "events": "@leftColor:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "rightGray_clicked",
      "value": false,
      "on": [
        {
          "events": "@rightGray:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    },
    {
      "name": "rightColor_clicked",
      "value": false,
      "on": [
        {
          "events": "@rightColor:click",
          "update": "{value: datum.index}",
          "force": true
        }
      ]
    }
  ],
  "data": [
    {
      "name": "dataset",
      "url": "https://dl.dropboxusercontent.com/s/28q9lso8enncqgl/csvjson%20%286%29.json"
    },
    {
      "name": "data-left",
      "source": "dataset",
      "transform": [{"type": "filter", "expr": "datum['candidate'] == 'Biden'"}]
    },
    {
      "name": "data-right",
      "source": "dataset",
      "transform": [{"type": "filter", "expr": "datum['candidate'] == 'Trump'"}]
    },
    {
      "name": "data-state",
      "source": "dataset",
      "transform": [
        {"type": "aggregate", "groupby": ["state", "index", "votes"]},
        {"type": "collect", "sort": {"field": "votes"}}
      ]
    },
    {
      "name": "claimed-left-state",
      "on": [
        {"trigger": "leftGray_clicked", "insert": "leftGray_clicked"},
        {"trigger": "rightColor_clicked", "remove": "rightColor_clicked"}
      ]
    },
    {
      "name": "claimed-right-state",
      "on": [
        {"trigger": "rightGray_clicked", "insert": "rightGray_clicked"},
        {"trigger": "leftColor_clicked", "remove": "leftColor_clicked"}
      ]
    },
    {
      "name": "data-left-to-right",
      "source": "data-left",
      "transform": [
        {
          "type": "filter",
          "expr": "indata('claimed-right-state', 'value', datum.index)"
        }
      ]
    },
    {
      "name": "data-right-with-claimed",
      "source": ["data-right", "data-left-to-right"],
      "transform": [
        {
          "type": "filter",
          "expr": "!indata('claimed-left-state', 'value', datum.index)"
        },
        {"type": "formula", "as": "side", "expr": "'Trump'"}
      ]
    },
    {
      "name": "data-total-right",
      "source": "data-right-with-claimed",
      "transform": [
        {
          "type": "stack",
          "groupby": ["side"],
          "sort": {"field": "votes", "order": "descending"},
          "field": "votes"
        }
      ]
    },
    {
      "name": "data-right-to-left",
      "source": "data-right",
      "transform": [
        {
          "type": "filter",
          "expr": "indata('claimed-left-state', 'value', datum.index)"
        }
      ]
    },
    {
      "name": "data-left-with-claimed",
      "source": ["data-left", "data-right-to-left"],
      "transform": [
        {
          "type": "filter",
          "expr": "!indata('claimed-right-state', 'value', datum.index)"
        },
        {"type": "formula", "as": "side", "expr": "'Trump'"}
      ]
    },
    {
      "name": "data-total-left",
      "source": "data-left-with-claimed",
      "transform": [
        {
          "type": "stack",
          "groupby": ["side"],
          "sort": {"field": "votes", "order": "descending"},
          "field": "votes"
        }
      ]
    },
    {
      "name": "data-left-sum",
      "source": "data-left",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["candidate"],
          "ops": ["sum"],
          "fields": ["votes"],
          "as": ["sum"]
        }
      ]
    },
    {
      "name": "data-right-sum",
      "source": "data-right",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["candidate"],
          "ops": ["sum"],
          "fields": ["votes"],
          "as": ["sum"]
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "scaleYStates",
      "type": "band",
      "range": [{"signal": "height"}, 0],
      "round": true,
      "domain": {"data": "data-state", "field": "index"}
    },
    {
      "name": "scaleLRCandidates",
      "type": "ordinal",
      "domain": ["Biden", "Trump"],
      "range": ["colorRightRed", "colorLeftBlue"]
    }
  ],
  "marks": [
    {
      "type": "text",
      "name": "stateName",
      "interactive": false,
      "from": {"data": "data-state"},
      "encode": {
        "enter": {
          "x": {"signal": "0"},
          "y": {"scale": "scaleYStates", "field": "index", "band": 0.5},
          "text": {"field": "state"},
          "baseline": {"value": "middle"},
          "align": {"value": "center"},
          "fill": {"signal": "colorStateLabel"}
        }
      }
    },
    {
      "type": "group",
      "name": "leftHorizontalBars",
      "encode": {"update": {"x": {"value": 0}, "height": {"signal": "height"}}},
      "scales": [
        {
          "name": "x",
          "reverse": true,
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "-chartPad"}],
          "nice": true,
          "zero": true,
          "domain": {"data": "dataset", "field": "votes"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "scale": "x",
          "format": "s",
          "title": {"signal": "'Biden'"},
          "titleColor": {"signal": "colorLeftBlue"}
        }
      ],
      "marks": [
        {
          "type": "rect",
          "name": "leftColor",
          "from": {"data": "data-left"},
          "interactive": true,
          "encode": {
            "enter": {
              "fill": {"signal": "colorLeftBlue"},
              "fillOpacity": {"signal": "fillOpacityDefault"},
              "x": {"scale": "x", "field": "votes"},
              "x2": {"scale": "x", "value": 0},
              "y": {"scale": "scaleYStates", "field": "index"},
              "height": {"scale": "scaleYStates", "band": 1, "offset": -1},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            }
          },
          "update": {
            "fill": {
              "signal": "indata('claimed-right-state', 'value', datum.index) ? colorGray : colorLeftBlue"
            },
            "fillOpacity": {
              "signal": "indata('claimed-right-state', 'value', datum.index) ? fillOpacityGray : fillOpacityDefault"
            }
          }
        },
        {
          "type": "rect",
          "name": "leftGray",
          "from": {"data": "data-right"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "votes"},
              "x2": {"scale": "x", "value": 0},
              "y": {"scale": "scaleYStates", "field": "index"},
              "height": {"scale": "scaleYStates", "band": 1, "offset": -1},
              "fillOpacity": {"signal": "fillOpacityGray"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? colorLeftBlue : colorGray"
              },
              "fillOpacity": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? fillOpacityClaimed : fillOpacityGray"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverGray"}}
          }
        },
        {
          "type": "text",
          "from": {"data": "data-left"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "votes"},
              "y": {"scale": "scaleYStates", "field": "index"},
              "dx": {"value": -5},
              "text": {"field": "votes"},
              "fontSize": {"value": 12},
              "font": {"value": "Thahoma"},
              "align": {"value": "right"},
              "baseline": {"value": "top"},
              "fill": {"signal": "colorLeftBlue"}
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "rightHorizontalBars",
      "encode": {
        "update": {"x": {"signal": "0"}, "height": {"signal": "height"}}
      },
      "scales": [
        {
          "name": "x",
          "type": "linear",
          "range": [{"signal": "chartPad"}, {"signal": "chartWidth"}],
          "nice": true,
          "zero": true,
          "domain": {"data": "dataset", "field": "votes"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "scale": "x",
          "format": "s",
          "title": "Trump",
          "titleColor": {"signal": "colorRightRed"}
        }
      ],
      "marks": [
        {
          "type": "rect",
          "name": "rightColor",
          "from": {"data": "data-right"},
          "interactive": true,
          "encode": {
            "enter": {
              "fillOpacity": {"signal": "fillOpacityDefault"},
              "x": {"scale": "x", "field": "votes"},
              "x2": {"scale": "x", "value": 0},
              "y": {"scale": "scaleYStates", "field": "index"},
              "height": {"scale": "scaleYStates", "band": 1, "offset": -1},
              "fill": {"scale": "scaleLRCandidates", "field": "candidate"},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? colorGray : colorRightRed"
              },
              "fillOpacity": {
                "signal": "indata('claimed-left-state', 'value', datum.index) ? fillOpacityGray : fillOpacityDefault"
              }
            }
          }
        },
        {
          "type": "rect",
          "name": "rightGray",
          "from": {"data": "data-left"},
          "interactive": true,
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "votes"},
              "x2": {"scale": "x", "value": 0},
              "y": {"scale": "scaleYStates", "field": "index"},
              "height": {"scale": "scaleYStates", "band": 1, "offset": -1},
              "fillOpacity": {"signal": "fillOpacityGray"},
              "fill": {"signal": "colorGray"}
            },
            "update": {
              "fill": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? colorRightRed : colorGray"
              },
              "fillOpacity": {
                "signal": "indata('claimed-right-state', 'value', datum.index) ? fillOpacityClaimed : fillOpacityGray"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverGray"}}
          }
        },
        {
          "type": "text",
          "from": {"data": "data-right"},
          "encode": {
            "enter": {
              "x": {"scale": "x", "field": "votes"},
              "y": {"scale": "scaleYStates", "field": "index"},
              "dx": {"value": 5},
              "text": {"field": "votes"},
              "fontSize": {"value": 12},
              "font": {"value": "Thahoma"},
              "align": {"value": "left"},
              "baseline": {"value": "top"},
              "fill": {
                "signal": "indata('data-left-with-claimed', 'value', datum.index) ? colorGray: colorRightRed"
              }
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "grpTotalLeft",
      "encode": {
        "update": {
          "x": {"signal": "0"},
          "y": {"signal": "-125"},
          "height": {"signal": "height"}
        }
      },
      "scales": [
        {
          "name": "scaleTotalLeft",
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "chartWidth"}],
          "reverse": false,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [0, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 538],
          "domainMin": 0,
          "domainMax": 538
        },
        {
          "name": "scaleTotalLeft2",
          "type": "linear",
          "range": [{"signal": "-chartWidth"}, {"signal": "chartWidth"}],
          "reverse": false,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [270],
          "domainMin": 0,
          "domainMax": 538
        },
        {"name": "y", "type": "band"},
        {"name": "color", "type": "ordinal", "range": "category"}
      ],
      "axes": [
        {
          "orient": "top",
          "zindex": 0,
          "bandPosition": 0,
          "scale": "scaleTotalLeft",
          "format": "s",
          "labels": true,
          "ticks": true,
          "tickOpacity": {"signal": "tickOpacity"},
          "tickSize": -55,
          "labelPadding": 55,
          "grid": false
        },
        {
          "orient": "top",
          "scale": "scaleTotalLeft2",
          "format": "s",
          "labels": true,
          "labelColor": "red",
          "ticks": true,
          "tickOpacity": {"signal": "tickOpacity"},
          "tickSize": -75,
          "tickColor": "red",
          "labelPadding": -15,
          "grid": false
        },
        {"orient": "right", "scale": "y", "format": "s", "ticks": true}
      ],
      "marks": [
        {
          "type": "text",
          "from": {"data": "data-left-sum"},
          "encode": {
            "enter": {
              "x": {"scale": "scaleTotalLeft", "field": "sum"},
              "dx": {"value": 5},
              "dy": {"value": 17},
              "text": {"signal": "datum.sum"},
              "stroke": {"signal": "colorLeftBlue"}
            }
          }
        },
        {
          "type": "rect",
          "zindex": 2,
          "from": {"data": "data-total-left"},
          "encode": {
            "enter": {
              "height": {"signal": "23"},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "y": {"signal": "1"},
              "x": {"scale": "scaleTotalLeft", "field": "y0"},
              "x2": {"scale": "scaleTotalLeft", "field": "y1"},
              "fill": {"signal": "colorLeftBlue"},
              "strokeWidth": {"value": 0.5},
              "strokeOpacity": {"value": 0.5},
              "stroke": {"signal": "colorStackSeparator"},
              "fillOpacity": {
                "signal": "datum.side==datum.candidate? fillOpacityClaimed : fillOpacityDefault"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverTotal"}}
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "grpTotalRight",
      "encode": {
        "update": {
          "x": {"signal": "-chartWidth"},
          "y": {"signal": "-100"},
          "height": {"signal": "height"}
        }
      },
      "scales": [
        {
          "name": "scaleTotalRight",
          "type": "linear",
          "range": [{"signal": "chartWidth*2"}, 0],
          "reverse": true,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [0, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 538],
          "domainMin": 0,
          "domainMax": 538
        },
        {
          "name": "scaleTotalRight2",
          "type": "linear",
          "range": [{"signal": "chartWidth*2"}, 0],
          "reverse": true,
          "domain": {"data": "dataset", "field": "votes"},
          "bins": [270],
          "domainMin": 0,
          "domainMax": 538
        },
        {
          "name": "y",
          "type": "band",
          "reverse": true,
          "range": "width",
          "domain": {"data": "data-total-right", "field": "candidate"}
        },
        {
          "name": "color",
          "type": "ordinal",
          "range": "width",
          "domain": {"data": "data-total-right", "field": "index"}
        }
      ],
      "axes": [
        {
          "orient": "top",
          "zindex": 0,
          "bandPosition": 1,
          "scale": "scaleTotalRight",
          "format": "s",
          "labels": true,
          "ticks": false,
          "tickSize": 0,
          "tickOpacity": {"signal": "tickOpacity"},
          "labelPadding": -45,
          "grid": false
        },
        {
          "orient": "top",
          "bandPosition": 0,
          "scale": "scaleTotalRight2",
          "format": "s",
          "labels": false,
          "ticks": true,
          "tickSize": 45,
          "tickColor": "red",
          "tickOpacity": {"signal": "tickOpacity"},
          "labelPadding": -40,
          "grid": false
        }
      ],
      "marks": [
        {
          "type": "text",
          "from": {"data": "data-right-sum"},
          "encode": {
            "enter": {
              "x": {"scale": "scaleTotalRight", "field": "sum"},
              "dx": {"value": 5},
              "dy": {"value": 17},
              "text": {"signal": "datum.sum"},
              "stroke": {"signal": "colorRightRed"}
            }
          }
        },
        {
          "type": "rect",
          "zindex": 2,
          "from": {"data": "data-total-right"},
          "encode": {
            "enter": {
              "height": {"signal": "23"},
              "tooltip": {"signal": "datum.state + ' - ' + datum.votes"}
            },
            "update": {
              "y": {"signal": "1"},
              "x": {"scale": "scaleTotalRight", "field": "y0"},
              "x2": {"scale": "scaleTotalRight", "field": "y1"},
              "fill": {"signal": "colorRightRed"},
              "strokeWidth": {"value": 0.5},
              "strokeOpacity": {"value": 0.5},
              "stroke": {"signal": "colorStackSeparator"},
              "fillOpacity": {
                "signal": "datum.side==datum.candidate? fillOpacityDefault : fillOpacityClaimed"
              }
            },
            "hover": {"fillOpacity": {"signal": "fillOpacityHoverTotal"}}
          }
        }
      ]
    }
  ],
  "config": {
    "autosize": {"contains": "padding", "type": "fit"},
    "text": {"font": "Thahoma", "fontSize": 14},
    "axis": {
      "ticks": true,
      "tickColor": "#BBBBBB",
      "grid": false,
      "domain": false,
      "labelColor": "#BBBBBB",
      "labelFontSize": 12,
      "titleFontSize": 20
    },
    "axisX": {"labelPadding": 5}
  }
}
